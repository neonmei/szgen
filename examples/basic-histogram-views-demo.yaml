opentelemetry:
  resource:
    attributes:
      - name: service.name
        value: "histogram-demo"
      - name: service.version
        value: "1.0.0"
      - name: environment
        value: "demo"
      - name: purpose
        value: "histogram-views-showcase"

  meter_provider:
    views:
      # Exponential histogram view for latency metrics
      - selector:
          instrument_name: "*.latency"
          instrument_type: "histogram"
        stream:
          aggregation:
            base2_exponential_bucket_histogram:
              max_scale: 20
              max_size: 160
              record_min_max: true

      # Explicit bucket histogram view for size metrics
      - selector:
          instrument_name: "*.size"
          instrument_type: "histogram"
        stream:
          aggregation:
            explicit_bucket_histogram:
              boundaries: [0, 100, 1000, 10000, 100000, 1000000]
              record_min_max: true

      # Custom buckets for response times
      - selector:
          instrument_name: "response.duration"
          instrument_type: "histogram"
        stream:
          aggregation:
            explicit_bucket_histogram:
              boundaries: [0.001, 0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0, 10.0]
              record_min_max: true

metrics:
  tasks:
    # Request latency with exponential histogram (uses view)
    - name: "request.latency"
      description: "HTTP request latency with exponential histogram aggregation"
      kind: "histogram"
      unit: "s"
      rate: "2s"
      count: 100
      value: "1.0,0.001"
      generator: "random"
      attributes:
        service: "web-api"
        endpoint: "/api/data"
        method: "GET"

    # Payload size with explicit buckets (uses view)
    - name: "payload.size"
      description: "Request payload size with explicit bucket aggregation"
      kind: "histogram"
      unit: "By"
      rate: "3s"
      count: 80
      value: "50000,100"
      generator: "random"
      attributes:
        service: "web-api"
        content_type: "application/json"

    # Response duration with custom buckets (uses view)
    - name: "response.duration"
      description: "Response processing time with custom bucket boundaries"
      kind: "histogram"
      unit: "s"
      rate: "1s"
      count: 150
      value: "3.0,0.005"
      generator: "random"
      attributes:
        service: "processor"
        operation: "data_transform"

    # Memory usage histogram without view configuration (uses default)
    - name: "memory.usage"
      description: "Memory usage without custom view (default aggregation)"
      kind: "histogram"
      unit: "By"
      rate: "5s"
      count: 60
      value: 67108864.0
      generator: "sine"
      attributes:
        component: "cache"
        pool: "main"

    # Database query time with exponential view
    - name: "db.query.latency"
      description: "Database query execution time"
      kind: "histogram"
      unit: "s"
      rate: "4s"
      count: 75
      value: "0.5,0.001"
      generator: "random"
      attributes:
        db_type: "postgresql"
        table: "users"
        operation: "SELECT"

    # File processing size metrics
    - name: "file.process.size"
      description: "Size of files being processed"
      kind: "histogram"
      unit: "By"
      rate: "6s"
      count: 50
      value: "1024.0,102400.0"
      generator: "step"
      attributes:
        file_type: "csv"
        processor: "batch_importer"
